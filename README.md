# Mini Apps template

Шаблон для создания нового приложения на базе [VK Mini Apps](https://vk.com/vkappsdev).

Стек технологий:
- Create React App
- VK Bridge
- VK UI
- VK Icons
- React Redux (with devtools extension and `unionize`)
- Typescript
- JSS

## Преимущества

В данный момент шаблон содержит все необходимые best practice для комфортной
разработки. Код содержит конкретный интуитивно понятный флоу, а также 
комментарии к практически каждой строке кода. 

Чуть более конкретно: 
- Предзагрузка ассетов для имитации поведения загрузки нативного приложения. 
Это означает, что когда мы хотим использовать какое-либо приложение, нам 
необходимо сначала его полностью загрузить, загрузить каждый ассет чтобы не 
делать это в процессе работы приложения, т.к. тогда это будет похоже на 
веб-приложение. Таким образом мы не заставим некоторые блоки моргать из-за 
загрузки;
- Создание [конфига](/src/config.ts) через переменные окружения;
- Флоу
    - Ожидание загрузки всех ассетов;
    - Отображение лоадера в процессе загрузки приложения;
    - Отображение ошибки в случае её возникновения где-то в React-дереве;
    - Отображение "лица" когда загрузка прошла успешно;
- Автоматиечски обнаружение внутренних рамок (инсетов). Полезно для iPhone X
и выше;
- Автоматическое обнаружение конфига приложения отправляемого vkbridge;
- Стилизация через JSS. Автоматическая установки темы в зависимости от цветовой 
схемы (to be done);

## Разработка

### Запуск проекта на vk.com и m.vk.com
В данный момент ВКонтакте требует https-адрес вашего приложения. Чтобы его 
получить, необходимо запустить CRA в безопасном режиме. Для этого мы используем
переменную HTTPS=true перед запуском скрипта react-scripts.

Для запуска в безопасном режиме использовать команду:

 ```bash 
yarn start:https
```

После того как проект запущен, мы получаем 2 адреса - `Local` и 
`On Your Network`. Необходимо использовать адрес `On Your Network`. Откройте
его в новой вкладке браузера и нажмите `Доверять сертификату`. Затем этот
адрес можно использовать в настройках вашего приложения в секциях для
`vk.com` и `m.vk.com`.

### Запуск проекта в нативной версии

Для запуска проекта необходимо запустить его в обычном режиме и создать ngrok 
туннель, который и даст нам https-адрес.
 
Запуск проекта в обычном режиме:

```bash
yarn start:http
```

Запуск туннеля ngrok:
```bash
yarn tunnel
```

После того как туннель создан, его адрес можно использовать в настройках 
приложения.

> **ВНИМАНИЕ**
>
> Сейчас "URL для разработчиков" в нативной версии не работает. Необходимо
> использовать поле "URL".
> 
> Ngrok имеет ограничения на количество одновременных подключений и запросов
> за определенный промежуток времени. Поэтому если вы попробуете загрузить
> большое кол-во запросов за короткий промежуток времени, туннель будет
> временно заблокирован. Вы можете подождать либо создать новый.
