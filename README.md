# Mini Apps template

Шаблон для создания нового приложения на базе [VK Mini Apps](https://vk.com/vkappsdev).

Стек технологий:
- Create React App
- VK Bridge
- VK UI
- VK Icons
- React Redux (вместе с devtools extension и `unionize`)
- Typescript
- JSS
- Customize CRA + React App Rewired

## Преимущества

В данный момент шаблон содержит все необходимые best practice для комфортной
разработки. Код содержит конкретный интуитивно понятный флоу, а также 
комментарии к практически каждой строке кода. 

- Отлавливание и отображение ошибки в случае её возникновения где-то в 
React-дереве
- `base64` кодирование изображений окнанчивающихся на `*.base64.*`. Позволяет
имитировать реальные нативные приложения таким образом, что этот контент
идет в комплекте со сборкой, а не подгружается потом отдельно
- Отслеживание изменений конфига приложения и внутренних отсутупов
- Парсинг и помещение в хранилище параметров запуска VK Mini Apps приложения
- Заранее подготовленные шаблоны View для ошибок и загрузки приложения 
- Создание [конфига](/src/config.ts) через переменные окружения
- Наличие сервисной панели, которая открывается при зажатии N пальцев 
одновременно в течение 1 секунды. Содержит кнопки перезагрузки приложения,
а так же чистки `bridge storage`. Полезно в случае, когда в хранилище находятся
некорректные данные
- Стилизация компонентов на базе JSS (темы появятся в скором будущем)

## Разработка

### Запуск проекта на vk.com и m.vk.com
В данный момент ВКонтакте требует https-адрес вашего приложения. Чтобы его 
получить, необходимо запустить CRA в безопасном режиме. Для этого мы используем
переменную HTTPS=true перед запуском скрипта react-scripts.

Для запуска в безопасном режиме использовать команду:

 ```bash 
yarn start:https
```

После того как проект запущен, мы получаем 2 адреса - `Local` и 
`On Your Network`. Необходимо использовать адрес `On Your Network`. Откройте
его в новой вкладке браузера и нажмите `Доверять сертификату`. Затем этот
адрес можно использовать в настройках вашего приложения в секциях для
`vk.com` и `m.vk.com`.

### Запуск проекта в нативной версии

Для запуска проекта необходимо запустить его в обычном режиме и создать ngrok 
туннель, который и даст нам https-адрес.
 
Запуск проекта в обычном режиме:

```bash
yarn start:http
```

Запуск туннеля ngrok:
```bash
yarn tunnel
```

После того как туннель создан, его адрес можно использовать в настройках 
приложения.

> **ВНИМАНИЕ**
>
> Сейчас "URL для разработчиков" в нативной версии не работает. Необходимо
> использовать поле "URL".
> 
> Ngrok имеет ограничения на количество одновременных подключений и запросов
> за определенный промежуток времени. Поэтому если вы попробуете загрузить
> большое кол-во запросов за короткий промежуток времени, туннель будет
> временно заблокирован. Вы можете подождать либо создать новый.
